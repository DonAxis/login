<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="stylesheet" href="botones.css">
 <link rel="stylesheet" href="Personas.css">
 <title>Panel de Coordinador</title>
 <style>
 .header {
 background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
 color: white;
 padding: 20px;
 border-radius: 10px;
 margin-bottom: 30px;
 display: flex;
 justify-content: space-between;
 align-items: center;
 }

 .header h1 {
 color: white;
 margin: 0;
 }

 .user-info {
 text-align: right;
 }

 .user-info p {
 margin: 5px 0;
 font-size: 0.9rem;
 }

 .btn-logout {
 background: rgba(255, 255, 255, 0.2);
 color: white;
 border: 2px solid white;
 padding: 8px 20px;
 border-radius: 8px;
 cursor: pointer;
 font-weight: 600;
 margin-top: 10px;
 transition: all 0.3s;
 }

 .btn-logout:hover {
 background: white;
 color: #43a047;
 }

 .menu-principal {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
 gap: 20px;
 margin-bottom: 30px;
 }

 .menu-card {
 background: white;
 padding: 25px;
 border-radius: 12px;
 box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
 text-align: center;
 cursor: pointer;
 transition: all 0.3s;
 border: 3px solid transparent;
 }

 .menu-card:hover {
 transform: translateY(-5px);
 box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
 border-color: #43a047;
 }

 .menu-card.active {
 border-color: #43a047;
 background: #f1f8e9;
 }

 .menu-card h3 {
 color: #43a047;
 margin-bottom: 10px;
 font-size: 1.3rem;
 }

 .menu-card p {
 color: #666;
 font-size: 0.9rem;
 }

 .seccion-contenido {
 display: none;
 background: white;
 padding: 25px;
 border-radius: 12px;
 box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
 }

 .seccion-contenido.active {
 display: block;
 animation: fadeIn 0.3s;
 }

 @keyframes fadeIn {
 from { opacity: 0; transform: translateY(10px); }
 to { opacity: 1; transform: translateY(0); }
 }

 .seccion-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 20px;
 padding-bottom: 15px;
 border-bottom: 2px solid #43a047;
 }

 .seccion-header h2 {
 color: #43a047;
 margin: 0;
 }

 .btn-volver {
 background: #e0e0e0;
 color: #333;
 padding: 8px 16px;
 border: none;
 border-radius: 6px;
 cursor: pointer;
 font-weight: 600;
 transition: all 0.2s;
 }

 .btn-volver:hover {
 background: #d0d0d0;
 }

 .lista-items {
 margin-top: 20px;
 }

 .item {
 background: #f5f5f5;
 padding: 15px;
 border-radius: 8px;
 margin-bottom: 10px;
 display: flex;
 justify-content: space-between;
 align-items: center;
 transition: all 0.2s;
 }

 .item:hover {
 background: #e8f5e9;
 transform: translateX(5px);
 }

 .item-info h4 {
 margin: 0 0 5px 0;
 color: #333;
 }

 .item-info p {
 margin: 0;
 color: #666;
 font-size: 0.9rem;
 }

 .item-acciones button {
 margin-left: 5px;
 }

 .sin-datos {
 text-align: center;
 padding: 40px;
 color: #999;
 }
 </style>
</head>
<body>

 <!-- TABS DE MODO -->
 <div style="background: linear-gradient(135deg, #216A32 0%, #21596A 100%); padding: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
 <div style="max-width: 1200px; margin: 0 auto; display: flex;">
 <button id="tabCoordinador" onclick="cambiarModo('coordinador')" 
 style="flex: 1; padding: 15px 30px; background: white; color: #216A32; border: none; border-bottom: 3px solid #216A32; cursor: pointer; font-size: 1.1rem; font-weight: 600; transition: all 0.3s;">
 Modo Coordinador
 </button>
 <button id="tabProfesor" onclick="cambiarModo('profesor')" 
 style="flex: 1; padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: 1.1rem; font-weight: 600; transition: all 0.3s;">
 ‍ Modo Profesor
 </button>
 </div>
 </div>

 <div class="header">
 <div>
 <h1>‍ Panel de Coordinador</h1>
 <p id="carreraInfo">Cargando...</p>
 </div>
 <div class="user-info">
 <p><strong>Nombre:</strong> <span id="nombreUsuario">Cargando...</span></p>
 <p><strong>Email:</strong> <span id="emailUsuario">Cargando...</span></p>
 <p><strong>Carrera:</strong> <span id="carreraUsuario">Cargando...</span></p>
 <p style="background: linear-gradient(135deg, #216A32 0%, #21596A 100%); color: white; padding: 8px 12px; border-radius: 6px; font-weight: 600; margin-top: 10px;">
 <strong>Periodo:</strong> <span id="periodoUsuario">Cargando...</span>
 </p>
 <button onclick="cerrarSesion()" class="btn-logout"> Cerrar Sesión</button>
 </div>
 </div>

 <!-- CONTENEDOR MODO COORDINADOR -->
 <div id="modoCoordinador" style="display: block;">
 
 <!-- MENÚ PRINCIPAL -->
 <div id="menuPrincipal" class="menu-principal">
 <div class="menu-card" id="menuCarreras" onclick="mostrarSeccion('carreras')" style="display: none;">
 <h3> Carreras</h3>
 <p>Gestionar carreras y programas</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('grupos')">
 <h3> Grupos</h3>
 <p>Gestionar grupos académicos</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('materias')">
 <h3> Materias</h3>
 <p>Crear y administrar materias</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('profesores')">
 <h3>‍ Gestionar Profesores</h3>
 <p>Crear y administrar profesores</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('alumnos')">
 <h3>‍ Gestionar Alumnos</h3>
 <p>Crear y administrar alumnos</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('asignaciones')">
 <h3> Armar Grupos</h3>
 <p>Asignar profesores a materias</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('inscripciones')">
 <h3> Inscripciones Especiales</h3>
 <p>Inscripciones fuera del grupo regular</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('calificaciones')">
 <h3> Calificaciones</h3>
 <p>Ver y editar calificaciones</p>
 </div>

 <div class="menu-card" onclick="mostrarSeccion('periodos')">
 <h3> Periodos</h3>
 <p>Gestionar periodos académicos</p>
 </div>
 </div>

 <!-- SECCIÓN: CARRERAS -->
 <div id="seccionCarreras" class="seccion-contenido">
 <div class="seccion-header">
 <h2> Gestión de Carreras</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>
 <div class="botones-accion">
 <button onclick="mostrarFormCarrera()" class="botAzu"> Nueva Carrera</button>
 </div>
 <div id="listaCarreras" class="lista-items"></div>
 </div>

 <!-- SECCIÓN: MATERIAS -->
 <div id="seccionMaterias" class="seccion-contenido">
 <div class="seccion-header">
 <h2> Gestión de Materias</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>
 <div class="botones-accion">
 <button onclick="mostrarFormMateria()" class="botAzu"> Nueva Materia</button>
 </div>
 <div id="listaMaterias" class="lista-items"></div>
 </div>

 <!-- SECCIÓN: GRUPOS -->
 <div id="seccionGrupos" class="seccion-contenido">
 <div class="seccion-header">
 <h2> Gestión de Grupos</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>
 <div class="botones-accion">
 <button onclick="mostrarGenerarGrupos()" class="botAzu">Generar Grupos</button>
 </div>
 <div id="listaGrupos" class="lista-items"></div>
 </div>

 <!-- SECCIÓN: GESTIONAR PROFESORES -->
 <div id="seccionProfesores" class="seccion-contenido">
 <div class="seccion-header">
 <h2>‍ Gestión de Profesores</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>
 <div class="botones-accion">
 <button onclick="mostrarFormProfesor()" class="botAzu"> Nuevo Profesor</button>
 </div>
 <div id="listaProfesores" class="lista-items"></div>
 </div>

 <!-- SECCIÓN: GESTIONAR ALUMNOS -->
 <div id="seccionAlumnos" class="seccion-contenido">
 <div class="seccion-header">
 <h2>‍ Registro de Alumnos</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>
 <div class="botones-accion">
 <button onclick="mostrarFormAlumno()" class="botAzu"> Nuevo Alumno</button>

 <button onclick="mostrarHistorialAlumnos()" class="botAzu" style="background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);">
 Ver Historial
 </button>
 </div>
 
 <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
 <div>
 <label style="font-weight: 600; display: block; margin-bottom: 5px;">Filtrar por estado:</label>
 <select id="filtroEstadoAlumnos" onchange="cargarAlumnos()" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 5px;">
 <option value="todos">Todos</option>
 <option value="activos">Solo estudiando</option>
 <option value="inactivos">Solo suspendidos</option>
 </select>
 </div>
 
 <div>
 <label style="font-weight: 600; display: block; margin-bottom: 5px;">Filtrar por grupo:</label>
 <select id="filtroGrupoAlumnos" onchange="cargarAlumnos()" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 5px;">
 <option value="todos">Todos los grupos</option>
 </select>
 </div>
 </div>
 
 <div id="listaAlumnos" class="lista-items"></div>
 </div>

 <!-- SECCIÓN: ASIGNAR PROFESORES -->
 <div id="seccionAsignaciones" class="seccion-contenido">
 <div class="seccion-header">
 <h2>‍ Armar Grupos (Materia + Profesor + Grupo)</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>
 <div class="botones-accion">
 <button onclick="mostrarFormAsignarProfesor()" class="botAzu"> Nueva Asignación</button>
 </div>
 <div id="listaAsignaciones" class="lista-items"></div>
 </div>

 <!-- SECCIÓN: INSCRIBIR ALUMNOS -->
 <div id="seccionInscripciones" class="seccion-contenido">
 <div class="seccion-header">
 <h2> Inscripciones Especiales</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>
 <div class="botones-accion">
 <button onclick="mostrarFormInscribirAlumno()" class="botAzu"> Nueva Inscripción</button>
 </div>
 <div id="listaInscripciones" class="lista-items"></div>
 </div>

 <!-- SECCIÓN: CALIFICACIONES -->
 <div id="seccionCalificaciones" class="seccion-contenido">
 <div class="seccion-header">
 <h2> Gestionar Calificaciones</h2>
 <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
 </div>

 <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
 <h3 style="margin-top: 0;">Seleccionar Materia</h3>
 <div style="display: grid; gap: 15px;">
 <div>
 <label style="display: block; margin-bottom: 5px; font-weight: 600;">Materia:</label>
 <select id="selectMateriaCalif" onchange="cargarCalificacionesMateria()" 
 style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
 <option value="">Seleccionar materia...</option>
 </select>
 <small style="color: #666; display: block; margin-top: 5px;">
 Selecciona una materia y grupo para ver y editar calificaciones
 </small>
 </div>
 </div>
 </div>

 <div id="contenedorCalificaciones" style="display: none;">
 <div style="background: white; padding: 20px; border-radius: 10px;">
 <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
 <div>
 <h3 style="margin: 0;" id="tituloMateriaCalif">Materia</h3>
 <p style="margin: 5px 0; color: #666;" id="infoMateriaCalif">Información de la materia</p>
 </div>
 <div style="display: flex; gap: 10px;">
 <button onclick="guardarTodasCalificacionesCoord()" 
 style="padding: 12px 24px; background: linear-gradient(135deg, #216A32 0%, #21596A 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;">
 Guardar Calificaciones
 </button>
 <button onclick="descargarActaPDF()" 
 style="padding: 12px 24px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;">
 Descargar PDF
 </button>
 </div>
 </div>
 <div id="tablaCalificacionesCoord"></div>
 </div>
 </div>
 </div>

 <!-- MODAL GENÉRICO -->
 <div id="modalGenerico" class="modal">
 <div class="modal-contenido">
 <span class="cerrar" onclick="cerrarModal()">&times;</span>
 <h2 id="tituloModal">Formulario</h2>
 <div id="contenidoModal"></div>
 </div>
 </div>

 <!-- Firebase SDK -->
 </div>
 <!-- FIN MODO COORDINADOR -->

 <!-- CONTENEDOR MODO PROFESOR -->
 <div id="modoProfesor" style="display: none;">
 <iframe id="iframeProfesor" src="" style="width: 100%; height: calc(100vh - 60px); border: none;"></iframe>
 </div>
 <!-- FIN MODO PROFESOR -->

 <!-- SECCION: PERIODOS -->
 <!-- SECCION: PERIODOS -->
<div id="seccionPeriodos" class="seccion-contenido">
  <div class="seccion-header">
    <h2>Periodos Academicos</h2>
    <button onclick="volverMenu()" class="btn-volver">← Volver al Menú</button>
  </div>

  <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
    <h3 style="margin-top: 0;">Informacion del Periodo Actual</h3>
    <div id="infoPeriodoActual" style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <div>
          <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">Periodo:</div>
          <div style="font-size: 1.8rem; font-weight: bold; color: #216A32;" id="periodoActualDisplay">2026-1</div>
        </div>
        <div>
          <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">Alumnos Activos:</div>
          <div style="font-size: 1.8rem; font-weight: bold; color: #1976d2;" id="alumnosActivosDisplay">0</div>
        </div>
        <div>
          <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">Grupos Activos:</div>
          <div style="font-size: 1.8rem; font-weight: bold; color: #f57c00;" id="gruposActivosDisplay">0</div>
        </div>
        <div>
          <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">Asignaciones Activas:</div>
          <div style="font-size: 1.8rem; font-weight: bold; color: #7b1fa2;" id="asignacionesActivasDisplay">0</div>
        </div>
      </div>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px;">
    <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #667eea;">
      <h3 style="margin-top: 0; color: #667eea;">Cambiar Periodo</h3>
      <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Avanza tu carrera al siguiente periodo academico</p>
      <button onclick="mostrarCambioPeriodo(usuarioActual.carreraId, periodoActualCarrera)" 
        style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Cambiar Periodo
      </button>
    </div>

    <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #4caf50;">
      <h3 style="margin-top: 0; color: #4caf50;">Historial de Grupos</h3>
      <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Ver grupos archivados de periodos anteriores</p>
      <button onclick="verHistorialGrupos(usuarioActual.carreraId)" 
        style="width: 100%; padding: 12px; background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Ver Historial
      </button>
    </div>
  </div>

  <div style="background: white; padding: 20px; border-radius: 10px;">
    <h3 style="margin-top: 0;">Informacion Importante</h3>
    <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; border-radius: 4px; margin-bottom: 15px;">
      <strong>Que sucede al cambiar periodo:</strong>
      <ul style="margin: 10px 0; padding-left: 20px;">
        <li>Los alumnos avanzan al siguiente semestre (Ej: 1101-MAT a 1201-MAT)</li>
        <li>Los alumnos de ultimo semestre pasan a GRADUADOS</li>
        <li>Los grupos actuales se archivan en el historial</li>
        <li>Las asignaciones de profesores se desactivan</li>
        <li>Las calificaciones se guardan en el historial</li>
      </ul>
    </div>
    
    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 4px; margin-bottom: 15px;">
      <strong>Importante:</strong>
      <p style="margin: 5px 0 0 0;">Esta accion solo afecta a tu carrera. Pero tus profesores y alumnos se veran afectados.</p>
    </div>
    
    <div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px;">
      <strong>Advertencia:</strong>
      <p style="margin: 5px 0 0 0;">El cambio de periodo NO se puede deshacer. Asegurate de que todo este correcto antes de continuar.</p>
    </div>
  </div>
</div>

 <!-- jsPDF para generar PDFs -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
 
 <script src="firebase.js"></script>
 <script src="logoPdf.js"></script>
 <script src="HistorialCoorPDF.js"></script>
 <script src="HistorialAlumnoPDF.js"></script>
 <script src="coordinador.js"></script>
 <script src="cambioPeriodo.js"></script>

 <!-- Verificar que jsPDF se cargó -->
 <script>
 window.addEventListener('load', () => {
 if (typeof window.jspdf !== 'undefined') {
 console.log('jsPDF cargado correctamente');
 } else {
 console.error('ERROR: jsPDF no se cargó');
 }
 });
 </script>

</body>
</html>