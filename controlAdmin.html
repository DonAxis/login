<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="botones.css">
  <link rel="stylesheet" href="Personas.css">
  <title>Panel de Administrador</title>
  <style>
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      color: white;
      margin: 0;
    }

    .user-info {
      text-align: right;
    }

    .user-info p {
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .btn-logout {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid white;
      padding: 8px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
      transition: all 0.3s;
    }

    .btn-logout:hover {
      background: white;
      color: #667eea;
    }

    .menu-opciones {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .opcion {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .opcion:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      border-color: #667eea;
    }

    .opcion h3 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .opcion p {
      color: #666;
      font-size: 0.9rem;
    }

    /* Estilos para sistema multi-carrera */
    .carrera-item {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .carrera-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    }

    #listaCarrerasAsignar::-webkit-scrollbar {
      width: 10px;
    }

    #listaCarrerasAsignar::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    #listaCarrerasAsignar::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 10px;
    }

    #listaCarrerasAsignar::-webkit-scrollbar-thumb:hover {
      background: #764ba2;
    }

    @keyframes fadeInModal {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal-content-animated {
      animation: fadeInModal 0.3s ease-out;
    }
  </style>
</head>
<body>

  <div class="header">
    <div>
      <h1>Panel de Administrador</h1>
      <p style="margin: 5px 0;">Sistema Escolar</p>
    </div>
    <div class="user-info">
      <p><strong id="userName">Cargando...</strong></p>
      <p id="userEmail"></p>
      <button onclick="cerrarSesion()" class="btn-logout">Cerrar Sesión</button>
    </div>
  </div>

  <div class="menu-opciones">
    <div class="opcion" onclick="mostrarModalCarrera()">
      <h3>Crear Carrera</h3>
      <p>Registrar nueva carrera en el sistema</p>
    </div>

    <div class="opcion" onclick="mostrarModalCoordinador()">
      <h3>Crear Coordinador</h3>
      <p>Registrar nuevo coordinador de carrera</p>
    </div>

    <div class="opcion" onclick="mostrarModalControlEscolar()">
      <h3>Crear Control Escolar</h3>
      <p>Registrar personal de control escolar</p>
    </div>

    <!-- NUEVO: Gestionar Coordinadores -->
    <div class="opcion" onclick="gestionarCoordinadores()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: 3px solid transparent;">
      <h3 style="color: white;">Gestionar Coordinadores</h3>
      <p style="color: rgba(255,255,255,0.95);">Asignar carreras múltiples y colores</p>
    </div>

    <div class="opcion" onclick="window.location.href='gestionUsuarios.html'">
      <h3>Gestionar Usuarios</h3>
      <p>Crear profesores y alumnos</p>
    </div>

    <div class="opcion" onclick="window.location.href='MenuPersonas.html'">
      <h3>Gestionar Alumnos (Viejo)</h3>
      <p>Sistema anterior de alumnos</p>
    </div>

    <div class="opcion" onclick="window.location.href='controlCoordinador.html'">
      <h3>Control Coordinador</h3>
      <p>Gestionar carreras, materias, grupos, profesores y alumnos</p>
    </div>

    <div class="opcion" onclick="mostrarControlPeriodos()" style="border: 3px solid #ff9800;">
      <h3>Control de Periodos (ADMIN)</h3>
      <p>Cambiar periodo sin restricciones - SOLO PRUEBAS</p>
    </div>

    <div class="opcion" onclick="alert('Próximamente')">
      <h3>Ver Reportes</h3>
      <p>Reportes y estadísticas</p>
    </div>

    <div class="opcion" onclick="alert('Próximamente')">
      <h3>Configuración</h3>
      <p>Configuración del sistema</p>
    </div>
  </div>

  <!-- MODAL CREAR COORDINADOR -->
  <div id="modalCoordinador" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 40px; border-radius: 15px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #667eea;">Nuevo Coordinador</h2>
        <button onclick="cerrarModalCoordinador()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</button>
      </div>

      <form id="formCoordinador" onsubmit="crearCoordinador(event)">
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Nombre Completo: *</label>
          <input type="text" id="nombreCoord" required placeholder="Ej: Luis Coordinador" 
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
        </div>

        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Email: *</label>
          <input type="email" id="emailCoord" required placeholder="coordinador@escuela.com"
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
        </div>

        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Contraseña: *</label>
          <input type="password" id="passCoord" required placeholder="Mínimo 6 caracteres" value="Coord123!"
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
          <small style="color: #666;">El coordinador podrá cambiarla después</small>
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Carrera: *</label>
          <select id="carreraCoord" required
                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
            <option value="">Seleccionar carrera...</option>
          </select>
        </div>

        <div style="display: flex; gap: 10px;">
          <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
            Crear Coordinador
          </button>
          <button type="button" onclick="cerrarModalCoordinador()" style="flex: 1; padding: 12px; background: #f5f5f5; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
            Cancelar
          </button>
        </div>
      </form>

      <div id="mensajeCoord" style="margin-top: 15px; padding: 15px; border-radius: 8px; display: none;"></div>
    </div>
  </div>

  <!-- MODAL CREAR CONTROL ESCOLAR -->
  <div id="modalControlEscolar" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 40px; border-radius: 15px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #FF6B35;">Nuevo Control Escolar</h2>
        <button onclick="cerrarModalControlEscolar()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</button>
      </div>

      <form id="formControlEscolar" onsubmit="crearControlEscolar(event)">
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Nombre Completo: *</label>
          <input type="text" id="nombreControl" required placeholder="Ej: Ana Garcia Lopez" 
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
        </div>

        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Email: *</label>
          <input type="email" id="emailControl" required placeholder="control@escuela.com"
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
        </div>

        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Contraseña: *</label>
          <input type="password" id="passControl" required placeholder="Minimo 6 caracteres" value="Control123!"
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
          <small style="color: #666;">El usuario podra cambiarla despues</small>
        </div>

        <div style="display: flex; gap: 10px;">
          <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
            Crear Control Escolar
          </button>
          <button type="button" onclick="cerrarModalControlEscolar()" style="flex: 1; padding: 12px; background: #f5f5f5; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
            Cancelar
          </button>
        </div>
      </form>

      <div id="mensajeControl" style="margin-top: 15px; padding: 15px; border-radius: 8px; display: none;"></div>
    </div>
  </div>

  <!-- MODAL CREAR CARRERA -->
  <div id="modalCarrera" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 40px; border-radius: 15px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #667eea;">Nueva Carrera</h2>
        <button onclick="cerrarModalCarrera()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</button>
      </div>

      <form id="formCarrera" onsubmit="crearCarrera(event)">
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Código de Carrera:</label>
          <input type="text" id="codigoCarrera" required placeholder="Ej: ING, MAT, MED" maxlength="10"
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; text-transform: uppercase;">
          <small style="color: #666;">Código único de 3-10 caracteres (mayúsculas)</small>
        </div>

        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Nombre de la Carrera:</label>
          <input type="text" id="nombreCarrera" required placeholder="Nombre completo"
                 style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Descripción (opcional):</label>
          <textarea id="descripcionCarrera" placeholder="Descripción de la carrera..." rows="3"
                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; resize: vertical;"></textarea>
        </div>

        <div style="display: flex; gap: 10px;">
          <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
            Crear Carrera
          </button>
          <button type="button" onclick="cerrarModalCarrera()" style="flex: 1; padding: 12px; background: #f5f5f5; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
            Cancelar
          </button>
        </div>
      </form>

      <div id="mensajeCarrera" style="margin-top: 15px; padding: 15px; border-radius: 8px; display: none;"></div>
    </div>
  </div>

  <!-- MODAL ASIGNAR CARRERAS A COORDINADORES -->
  <div id="modalAsignarCarreras" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; overflow-y: auto; backdrop-filter: blur(3px);">
    <div class="modal-content-animated" style="background: white; padding: 40px; border-radius: 20px; max-width: 800px; width: 90%; margin: 40px auto; box-shadow: 0 25px 80px rgba(0,0,0,0.4);">
      
      <!-- Header del Modal -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #667eea;">
        <div>
          <h2 style="margin: 0; color: #667eea; font-size: 2rem;">Asignar Carreras a Coordinador</h2>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 0.95rem;">
            Configura qué carreras puede gestionar y asigna colores distintivos
          </p>
        </div>
        <button onclick="cerrarModalAsignarCarreras()" 
          style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #999; line-height: 1; padding: 0; width: 40px; height: 40px; border-radius: 50%; transition: all 0.3s;"
          onmouseover="this.style.background='#f5f5f5'; this.style.color='#333';"
          onmouseout="this.style.background='none'; this.style.color='#999';">
          &times;
        </button>
      </div>

      <!-- Información del Coordinador -->
      <div id="infoCoordinadorActual" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
        <div style="font-weight: 700; font-size: 1.3rem;" id="nombreCoordActual">-</div>
        <div style="font-size: 0.95rem; opacity: 0.95; margin-top: 3px;">
          <span id="emailCoordActual">-</span>
        </div>
      </div>

      <!-- Instrucciones -->
      <div style="background: #fff9e6; border-left: 5px solid #ffc107; padding: 18px; border-radius: 8px; margin-bottom: 25px;">
        <strong style="color: #856404; font-size: 1.05rem;">Instrucciones:</strong>
        <ul style="margin: 10px 0 0 0; padding-left: 20px; color: #856404; line-height: 1.8;">
          <li>Selecciona las carreras que este coordinador puede gestionar</li>
          <li>Asigna un color único a cada carrera para distinguirlas fácilmente</li>
          <li>El header del panel cambiará según la carrera activa</li>
          <li>Evita usar el mismo color para múltiples carreras del mismo coordinador</li>
        </ul>
      </div>

      <!-- Lista de Carreras -->
      <div style="margin-bottom: 25px;">
        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 1.3rem;">Carreras Disponibles</h3>
        
        <div id="listaCarrerasAsignar" style="max-height: 450px; overflow-y: auto; padding-right: 10px;">
          <div style="text-align: center; padding: 40px; color: #999;">
            <p>Cargando carreras...</p>
          </div>
        </div>
      </div>

      <!-- Botones de Acción -->
      <div style="display: flex; gap: 12px; margin-top: 25px;">
        <button onclick="guardarAsignacionCarreras()" 
          style="flex: 1; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 700; cursor: pointer; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); transition: all 0.3s;"
          onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.5)';"
          onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)';">
          Guardar Asignaciones
        </button>
        
        <button onclick="cerrarModalAsignarCarreras()" 
          style="flex: 1; padding: 16px; background: white; border: 3px solid #ddd; border-radius: 10px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; color: #666;"
          onmouseover="this.style.background='#f5f5f5'; this.style.borderColor='#999';"
          onmouseout="this.style.background='white'; this.style.borderColor='#ddd';">
          Cancelar
        </button>
      </div>

      <!-- Mensaje de Estado -->
      <div id="mensajeAsignacion" style="margin-top: 20px; display: none;"></div>

    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script src="firebase.js"></script>
  <script src="controlAdmin.js"></script>
</body>
</html>